<!DOCTYPE html>
<!-- saved from url=(0075)https://selab.hanyang.ac.kr/courses/cse326/2019/lecture/12-ajaxXmlJson.html -->
<html lang="en">

    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta charset="UTF-8">
        <link rel="stylesheet" href="../slide.css">
        <script type="text/javascript" src="../jquery-3.4.1.min.js"></script>
        <script type="text/javascript" src="../slide.js"></script>
        <title>Ajax, XML, JSON</title>
    </head>

<body>
    <div class="layout">
        <div id="controls">
            <form action="https://selab.hanyang.ac.kr/courses/cse326/2019/lecture/12-ajaxXmlJson.html#" id="controlForm"
                undefined="">
                <div id="navLinks">
                    <div id="navaLinks">
                        <a accesskey="t" id="toggle" title="Print View"
                            href="javascript:printView();">Ø</a>
                        <a accesskey="z" id="prev" title="Previous Slide"
                            href="javascript:moveSlide(-1);">«</a>
                        <a accesskey="x" id="next" title="Next Slide"
                            href="javascript:moveSlide(1);">»</a>
                    </div>
                    <div id="navList"><select id="jumplist" onchange="jumpSlide();">
                            <option value="0 : CSE3026: Web Application Development  Ajax, XML, and JSON">0 : CSE3026:
                                Web Application Development Ajax, XML, and JSON</option>
                            <option value="1 : === 12.1: Ajax Concepts ===">1 : === 12.1: Ajax Concepts ===</option>
                            <option value="2 : 
		Synchronous web communication
	">2 :
                                Synchronous web communication
                            </option>
                            <option value="3 : Web applications and Ajax">3 : Web applications and Ajax</option>
                            <option value="4 : Asynchronous web communication">4 : Asynchronous web communication
                            </option>
                            <option value="5 : === 12.2: Using XMLHttpRequest ===">5 : === 12.2: Using XMLHttpRequest
                                ===</option>
                            <option value="6 : XMLHttpRequest (&amp; why we won&#39;t use it)">6 : XMLHttpRequest (&amp;
                                why we won't use it)</option>
                            <option value="7 : A typical Ajax request">7 : A typical Ajax request</option>
                            <option value="8 : 
		Prototype&#39;s Ajax model
	">8 :
                                Prototype's Ajax model
                            </option>
                            <option value="9 : Prototype Ajax options">9 : Prototype Ajax options</option>
                            <option value="10 : Prototype Ajax event options">10 : Prototype Ajax event options</option>
                            <option value="11 : Basic Prototype Ajax template">11 : Basic Prototype Ajax template
                            </option>
                            <option value="12 : Ajax response object&#39;s properties">12 : Ajax response object's
                                properties</option>
                            <option value="13 : Handling Ajax errors">13 : Handling Ajax errors</option>
                            <option value="14 : Passing query parameters to a request">14 : Passing query parameters to
                                a request</option>
                            <option value="15 : Creating a POST request">15 : Creating a POST request</option>
                            <option value="16 : 
		XMLHttpRequest security restrictions
	">16 :
                                XMLHttpRequest security restrictions
                            </option>
                            <option value="17 : Prototype&#39;s Ajax Updater">17 : Prototype's Ajax Updater</option>
                            <option value="18 : Ajax.Updater options">18 : Ajax.Updater options</option>
                            <option value="19 : PeriodicalUpdater">19 : PeriodicalUpdater</option>
                            <option value="20 : Ajax.Responders">20 : Ajax.Responders</option>
                            <option value="21 : === 12.3: XML ===">21 : === 12.3: XML ===</option>
                            <option value="22 : The bad way to store data (text formats)">22 : The bad way to store data
                                (text formats)</option>
                            <option value="23 : XML: A better way of storing data">23 : XML: A better way of storing
                                data</option>
                            <option value="24 : What is XML?">24 : What is XML?</option>
                            <option value="25 : Anatomy of an XML file">25 : Anatomy of an XML file</option>
                            <option value="26 : Uses of XML">26 : Uses of XML</option>
                            <option value="27 : What tags are legal in XML?">27 : What tags are legal in XML?</option>
                            <option value="28 : Schemas and Doctypes">28 : Schemas and Doctypes</option>
                            <option value="29 : XML and Ajax">29 : XML and Ajax</option>
                            <option value="30 : Fetching XML using Ajax (template)">30 : Fetching XML using Ajax
                                (template)</option>
                            <option value="31 : XML DOM tree structure">31 : XML DOM tree structure</option>
                            <option value="32 : Interacting with XML DOM nodes">32 : Interacting with XML DOM nodes
                            </option>
                            <option value="33 : Differences from HTML DOM">33 : Differences from HTML DOM</option>
                            <option value="34 : Full list of XML DOM properties">34 : Full list of XML DOM properties
                            </option>
                            <option value="35 : Ajax XML DOM example">35 : Ajax XML DOM example</option>
                            <option value="36 : Larger XML file example">36 : Larger XML file example</option>
                            <option value="37 : Navigating node tree example">37 : Navigating node tree example</option>
                            <option value="38 : Pros and cons of XML">38 : Pros and cons of XML</option>
                            <option value="39 : === 12.4: JSON ===">39 : === 12.4: JSON ===</option>
                            <option value="40 : JavaScript Object Notation (JSON)">40 : JavaScript Object Notation
                                (JSON)</option>
                            <option value="41 : Recall: JavaScript object syntax">41 : Recall: JavaScript object syntax
                            </option>
                            <option value="42 : An example of XML data">42 : An example of XML data</option>
                            <option value="43 : The equivalant JSON data">43 : The equivalant JSON data</option>
                            <option value="44 : Browser JSON methods">44 : Browser JSON methods</option>
                            <option value="45 : JSON expressions exercise">45 : JSON expressions exercise</option>
                            <option value="46 : JSON example: Books">46 : JSON example: Books</option>
                            <option value="47 : JSON exercise">47 : JSON exercise</option>
                            <option value="48 : Working with JSON book data">48 : Working with JSON book data</option>
                            <option value="49 : Bad style: the eval function">49 : Bad style: the eval function</option>
                        </select></div>
                </div>
            </form>
        </div>
        <div id="currentSlide">
            <!-- DO NOT EDIT -->
        </div>
        <div id="header"></div>
        <div id="footer">
            <h1>CSE3026: Web Application Development</h1>
            <h2>12. Ajax, XML, and JSON</h2>
        </div>
    </div>

    <div class="presentation">
        <div class="slide" id="slide0">
            <h1><span class="smallerFont">CSE3026: Web Application Development</span> <br> <strong>Ajax, XML, and
                    JSON</strong></h1>
            <br>
            <h2>Scott Uk-Jin Lee</h2>

            <p class="license">
                Reproduced with permission of the authors.
                Copyright 2012 Marty Stepp, Jessica Miller, and Victoria Kirst.
                All rights reserved.
                Further reproduction or distribution is prohibited without written permission.
            </p>

            <div class="w3c">
                <a href="https://validator.w3.org/check/referer"><img
                        src="./CSE3026 - 12. Ajax, XML, and JSON_files/w3c-html.png" alt="Valid HTML 5"></a>
                <a href="https://jigsaw.w3.org/css-validator/check/referer"><img
                        src="./CSE3026 - 12. Ajax, XML, and JSON_files/w3c-css.png" alt="Valid CSS!"></a>
            </div>
        </div>



        <div class="slide titleslide" id="slide1">
            <h1>12.1: Ajax Concepts</h1>

            <ul>
                <li>
                    <strong>12.1: Ajax Concepts</strong>
                </li>
                <li>
                    12.2: Using XMLHttpRequest
                </li>
                <li>
                    12.3: XML
                </li>
                <li>
                    12.4: JSON
                </li>
            </ul>
        </div>



        <div class="slide" id="slide2">
            <h1>
                Synchronous web communication
            </h1>

            <div class="centerfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/figure_1_synchronous.png"
                    alt="synchronous communication" style="width: 60%;">
            </div>

            <ul>
                <li><span class="term">synchronous</span>: user must wait while new pages load
                    <ul>
                        <li>
                            the typical communication pattern used in web pages (click, wait, refresh)
                        </li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide3">
            <h1><a href="http://en.wikipedia.org/wiki/Web_application">Web applications</a> and Ajax</h1>

            <div class="rightfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/ajax_bleach.gif" alt="Ajax bleach">
            </div>

            <ul>
                <li>
                    <span class="term">web application</span>: a dynamic web site that mimics the feel of a desktop app
                    <ul>
                        <li>
                            presents a continuous user experience rather than disjoint pages
                        </li>
                        <li>
                            examples:
                            <a href="http://mail.google.com/">Gmail</a>,
                            <a href="http://maps.google.com/">Google Maps</a>,
                            <a href="http://docs.google.com/">Google Docs and Spreadsheets</a>,
                            <a href="http://www.flickr.com/">Flickr</a>,
                            <a href="http://www.a9.com/">A9</a>
                        </li>
                    </ul>
                </li>

                <li>
                    <span class="term">Ajax</span>: Asynchronous JavaScript and XML
                    <ul>
                        <li>not a programming language; a particular way of using JavaScript</li>
                        <li>downloads data from a server in the background</li>
                        <li>allows dynamically updating a page without making the user wait</li>
                        <li>avoids the "click-wait-refresh" pattern</li>
                        <li>
                            examples: <a href="http://www.google.com/">Google Suggest</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide4">
            <h1>Asynchronous web communication</h1>

            <div class="centerfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/figure_2_asynchronous.png"
                    alt="synchronous communication" style="width: 60%;">
            </div>

            <ul>
                <li><span class="term">asynchronous</span>: user can keep interacting with page while data loads
                    <ul>
                        <li>
                            communication pattern made possible by Ajax
                        </li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide titleslide" id="slide5">
            <h1>12.2: Using XMLHttpRequest</h1>

            <ul>
                <li>
                    12.1: Ajax Concepts
                </li>
                <li>
                    <strong>12.2: Using XMLHttpRequest</strong>
                </li>
                <li>
                    12.3: XML
                </li>
                <li>
                    12.4: JSON
                </li>
            </ul>
        </div>



        <div class="slide" id="slide6">
            <h1><a href="http://www.w3schools.com/XML/xml_http.asp"><code>XMLHttpRequest</code></a> (&amp; why we won't
                use it)</h1>

            <ul>
                <li>JavaScript includes an <code>XMLHttpRequest</code> object that can fetch files from a web server
                    <ul>
                        <li>supported in IE5+, Safari, Firefox, Opera, Chrome, etc. (with minor compatibilities)</li>
                    </ul>
                </li>
                <!--
		Internet Explorer uses an ActiveXObject, while other browsers uses the built-in JavaScript object called XMLHttpRequest.
		-->

                <li>it can do this <span class="term">asynchronously</span> (in the background, transparent to user)
                </li>
                <li>the contents of the fetched file can be put into current web page using the DOM</li>

                <li style="margin-top: 2em">sounds great!...</li>
                <li class="">... but it is clunky to use, and has various browser incompatibilities</li>
                <li class="">Prototype provides a better wrapper for Ajax, so we will use that instead</li>
            </ul>
        </div>



        <div class="slide" id="slide7">
            <h1>A typical Ajax request</h1>

            <div class="rightfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/ajax_request.png" alt="request"
                    style="max-width: 100%">
            </div>

            <ol class="compressed">
                <li>user clicks, invoking an event handler</li>
                <li class="">handler's code creates an <code>XMLHttpRequest</code> object</li>
                <li class=""><code>XMLHttpRequest</code> object requests page from server</li>
                <li class="">server retrieves appropriate data, sends it back</li>
                <li class=""><code>XMLHttpRequest</code> fires an event when data arrives
                    <ul>
                        <li>this is often called a <span class="term">callback</span></li>
                        <li>you can attach a handler function to this event</li>
                    </ul>
                </li>
                <li class="">your callback event handler processes the data and displays it</li>
            </ol>
        </div>



        <div class="slide" id="slide8">
            <h1>
                Prototype's Ajax model
            </h1>

            <pre class="syntaxtemplate js">new Ajax.Request("<var>url</var>", {
    <var>option</var> : <var>value</var>,
    <var>option</var> : <var>value</var>,
    ...
    <var>option</var> : <var>value</var>
});
</pre>

            <ul>
                <li>construct a Prototype <code>Ajax.Request</code> object to request a page from a server using Ajax
                </li>

                <li>constructor accepts 2 parameters:
                    <ol>
                        <li>the <strong>URL</strong> to fetch, as a String,</li>
                        <li>
                            a set of <a class="popup" href="http://prototypejs.org/doc/latest/ajax/"
                                target="_blank"><strong>options</strong></a>, as an array of <var>key</var> :
                            <var>value</var> pairs in <code>{}</code> braces
                            <span class="aside">(an anonymous JS object)</span>
                        </li>
                    </ol>
                </li>
                <li>hides icky details from the raw <code>XMLHttpRequest</code>; works well in all browsers</li>
            </ul>
        </div>



        <div class="slide" id="slide9">
            <h1>Prototype Ajax <a class="popup" href="http://prototypejs.org/doc/latest/ajax/"
                    target="_blank">options</a></h1>

            <table class="standard">
                <tbody>
                    <tr class=" evenrow">
                        <th>option</th>
                        <th>description</th>
                    </tr>

                    <tr>
                        <td>
                            <code>method</code>
                        </td>
                        <td>
                            how to fetch the request from the server (default <code>"post"</code>)
                        </td>
                    </tr>

                    <tr class=" evenrow">
                        <td>
                            <code>parameters</code>
                        </td>
                        <td>
                            query parameters to pass to the server, if any (as a string or object)
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <code>asynchronous</code>
                        </td>
                        <td>
                            should request be sent asynchronously in the background? (default <code>true</code>)
                        </td>
                    </tr>

                    <tr class=" evenrow">
                        <td colspan="2" style="font-size: smaller;">
                            others: <code>contentType</code>, <code>encoding</code>,
                            <code>requestHeaders</code>
                        </td>
                    </tr>
                </tbody>
            </table>

            <pre class="syntaxtemplate js">new Ajax.Request("http://www.example.com/foo/bar.txt", {
    <em>method: "get",
    parameters: {name: "Ed Smith", age: 29},</em>   <span class="comment">// "name=Ed+Smith&amp;age=29"</span>
    <var>...</var>
});
</pre>
        </div>



        <div class="slide" id="slide10">
            <h1>Prototype Ajax event <a class="popup" href="http://prototypejs.org/doc/latest/ajax/"
                    target="_blank">options</a></h1>

            <table class="standard">
                <tbody>
                    <tr class=" evenrow">
                        <th>event</th>
                        <th>description</th>
                    </tr>

                    <tr>
                        <td>
                            <code>onSuccess</code>
                        </td>
                        <td>
                            request completed successfully
                        </td>
                    </tr>

                    <tr class=" evenrow">
                        <td>
                            <code>onFailure</code>
                        </td>
                        <td>
                            request was unsuccessful
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <code>onException</code>
                        </td>
                        <td>
                            request has a syntax error, security error, etc.
                        </td>
                    </tr>

                    <tr class=" evenrow">
                        <td colspan="2" style="font-size: smaller;">
                            others: <code>onCreate</code>, <code>onComplete</code>,
                            <code>on###</code> (for HTTP error code ###)
                        </td>
                    </tr>
                </tbody>
            </table>

            <pre class="syntaxtemplate js">new Ajax.Request("http://www.example.com/foo.php", {
    parameters: {password: "abcdef"},   <span class="comment">// "password=abcdef"</span>
    <em>onSuccess: mySuccessFunction</em>
});
</pre>
        </div>



        <div class="slide" id="slide11">
            <h1>Basic Prototype Ajax template</h1>

            <pre class="syntaxtemplate js">    new Ajax.Request("<var>url</var>", {
        method: "get",
        onSuccess: <var>functionName</var>
    });
    ...

function <var>functionName</var>(<em>ajax</em>) {
    <var>do something with <em>ajax.responseText</em></var>;
}
</pre>

            <ul>
                <li>attach a handler to the request's <code>onSuccess</code> event</li>
                <li>the handler takes an <a href="http://www.prototypejs.org/doc/latest/ajax/Ajax/Response">Ajax
                        response object</a>, which we'll name <code>ajax</code>, as a parameter</li>
            </ul>
        </div>



        <div class="slide" id="slide12">
            <h1>Ajax response object's <a href="http://prototypejs.org/doc/latest/ajax/Ajax/Response/">properties</a>
            </h1>

            <table class="standard">
                <tbody>
                    <tr class=" evenrow">
                        <th>property</th>
                        <th>description</th>
                    </tr>

                    <tr>
                        <td>
                            <code>status</code>
                        </td>
                        <td>
                            the request's <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP error
                                code</a> (200 = OK, etc.)
                        </td>
                    </tr>

                    <tr class=" evenrow">
                        <td>
                            <code>statusText</code>
                        </td>
                        <td>
                            HTTP error code text
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <code>responseText</code>
                        </td>
                        <td>
                            the entire text of the fetched file, as a <code>String</code>
                        </td>
                    </tr>

                    <tr class=" evenrow">
                        <td>
                            <code>responseXML</code>
                        </td>
                        <td>
                            the entire contents of the fetched file, as a DOM tree (seen later)
                        </td>
                    </tr>
                </tbody>
            </table>

            <pre class="examplecode js">function handleRequest(ajax) {
    alert(<em>ajax.responseText</em>);
}
</pre>

            <ul>
                <li>most commonly used property is <code>responseText</code>, to access the fetched text content</li>
            </ul>
        </div>



        <div class="slide" id="slide13">
            <h1>Handling Ajax errors</h1>

            <pre class="syntaxtemplate js">    new Ajax.Request("<var>url</var>", {
        method: "get",
        onSuccess: <var>functionName</var>,
        <em>onFailure: ajaxFailure</em>,
        <em>onException: ajaxFailure</em>
    });
    ...
<em>function ajaxFailure(ajax, exception) {</em>
    alert("Error making Ajax request:" + 
          "\n\nServer status:\n" + ajax.status + " " + ajax.statusText + 
          "\n\nServer response text:\n" + ajax.responseText);
    if (exception) {
        throw exception;
    }
}
</pre>

            <ul>
                <li>for user's (and developer's) benefit, show an error message if a request fails</li>
            </ul>
        </div>


        <!-- ***********************************************************************************************
<div class="slide">
	<h1>Debugging Ajax code</h1>

	<div class="centerfigure">
		<img src="images/firebug_ajax.png" alt="Firebug Ajax" style="max-width: 70%;" />
	</div>

	<ul>
		<li>Chrome's <strong>Network</strong> tab (Firebug's <strong>Net</strong> tab) shows each request, its parameters, response, errors</li>
		<li>expand a request with <span class="term" style="border: 1px solid black;">+</span> and look at <span class="term">Response</span> tab to see Ajax result</li>
		<li>check <strong>Console</strong> tab for any errirs that are thrown by requests</li>
	</ul>
</div>
-->


        <div class="slide" id="slide14">
            <h1>Passing query parameters to a request</h1>

            <pre class="syntaxtemplate js">new Ajax.Request("lookup_account.php", {
    method: "get",
    <em>parameters: {name: "Ed Smith", age: 29, password: "abcdef"}</em>,
    onFailure: ajaxFailure,
    onException: ajaxFailure
});
...
</pre>

            <ul>
                <li>don't concatenate the parameters onto the URL yourself with <code>"?" + </code>...
                    <ul>
                        <li>won't properly <a href="http://www.w3schools.com/tags/ref_urlencode.asp">URL-encode</a> the
                            parameters</li>
                        <li>won't work for POST requests</li>
                    </ul>
                </li>
                <li>query parameters are passed as a <code>parameters</code> object
                    <ul>
                        <li>written between <code>{}</code> braces as a set of <var>name</var> : <var>value</var> pairs
                            <span class="aside">(another anonymous object)</span></li>
                        <li>(the above is equivalent to: <code>"name=Ed+Smith&amp;age=29&amp;password=abcdef"</code>)
                        </li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide15">
            <h1>Creating a <code>POST</code> request</h1>

            <pre class="syntaxtemplate js">new Ajax.Request("<var>url</var>", {
    <em>method: "post",</em>   <span class="comment">// optional</span>
    <em>parameters: { <var>name</var>: <var>value</var>, <var>name</var>: <var>value</var>, ..., <var>name</var>: <var>value</var> },</em>
    onSuccess: <var>functionName</var>,
    onFailure: <var>functionName</var>,
    onException: <var>functionName</var>
});
</pre>

            <ul>
                <li><code>method</code> should be changed to <code>"post"</code> (or omitted; <code>post</code> is
                    default)</li>
            </ul>
        </div>



        <div class="slide" id="slide16">
            <h1>
                <code>XMLHttpRequest</code> security restrictions
            </h1>

            <div class="centerfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/ajax_security_error.png" alt="Ajax security error">
            </div>

            <ul>
                <li>Ajax must be run on a web page stored on a <strong>web server</strong>
                    <ul>
                        <li><em>(cannot be run from a web page stored on your hard drive)</em></li>
                    </ul>
                </li>
                <li>Ajax can only fetch files from the <strong>same server</strong> that the page is on
                    <ul>
                        <li><code>http://www.foo.com/a/b/c.html</code> can only fetch from <code>www.foo.com</code>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide17">
            <h1>Prototype's Ajax Updater</h1>

            <pre class="syntaxtemplate js">new Ajax.Updater("<var>id</var>", "<var>url</var>", {
    method: "get"
});
</pre>

            <hr>

            <ul>
                <li><a href="http://www.prototypejs.org/doc/latest/ajax/Ajax/Updater"><code>Ajax.Updater</code></a>
                    fetches a file and injects its content into an element as <code>innerHTML</code>
                    <ul>
                        <li>this is a common Ajax use case: "go fetch this page/file, and put its contents into an
                            element on the page"</li>
                        <li>could do this with <code>Ajax.Request</code>, but <code>Ajax.Updater</code> saves you some
                            typing and work</li>
                    </ul>
                </li>
                <li>additional (1st) parameter specifies the <code>id</code> of element to inject into</li>
                <li><code>onSuccess</code> handler not needed (but <code>onFailure</code>, <code>onException</code>
                    handlers may still be useful)</li>
            </ul>
        </div>



        <div class="slide" id="slide18">
            <h1>Ajax.Updater options</h1>

            <pre class="syntaxtemplate js">new Ajax.Updater(<em>{success: "<var>id</var>", failure: "<var>id</var>"}</em>, "<var>url</var>", {
    method: "get",
    <em>insertion: "top"</em>
});
</pre>

            <hr>

            <ul>
                <li>instead of passing a single id, you can pass an object with a <code>success</code> and/or
                    <code>failure</code> id
                    <ul>
                        <li>the <code>success</code> element will be filled if the request succeeds</li>
                        <li>the <code>failure</code> element (if provided) will be filled if the request fails</li>
                    </ul>
                </li>
                <li><code>insertion</code> parameter specifies where in the element to insert the text (top, bottom,
                    before, after)</li>
            </ul>
        </div>



        <div class="slide" id="slide19">
            <h1>PeriodicalUpdater</h1>

            <pre class="syntaxtemplate js">new Ajax.PeriodicalUpdater("<var>id</var>", "<var>url</var>", {
    frequency: <var>seconds</var>,
    <var>name</var>: <var>value</var>, ...
});
</pre>

            <hr>

            <ul>
                <li><a
                        href="http://www.prototypejs.org/doc/latest/ajax/Ajax/PeriodicalUpdater"><code>Ajax.PeriodicalUpdater</code></a>
                    repeatedly fetches a file at a given interval and injects its content into an element as
                    <code>innerHTML</code></li>
                <li><code>onSuccess</code> handler not needed (but <code>onFailure</code>, <code>onException</code>
                    handlers may still be useful)</li>
                <li>same options as in <code>Ajax.Updater</code> can be passed</li>
            </ul>
        </div>



        <div class="slide" id="slide20">
            <h1>Ajax.Responders</h1>

            <pre class="syntaxtemplate js">Ajax.Responders.register({
    on<var>Event</var>: <var>functionName</var>,
    on<var>Event</var>: <var>functionName</var>,
    ...
});
</pre>

            <hr>

            <ul>
                <li>sets up a default handler for a given kind of event for all Ajax requests</li>
                <li>can be useful for attaching a <strong>common failure/exception handler</strong> to all requests in
                    one place</li>
            </ul>
        </div>



        <div class="slide titleslide" id="slide21">
            <h1>12.3: XML</h1>

            <ul>
                <li>
                    12.1: Ajax Concepts
                </li>
                <li>
                    12.2: Using XMLHttpRequest
                </li>
                <li>
                    <strong>12.3: XML</strong>
                </li>
                <li>
                    12.4: JSON
                </li>
            </ul>
        </div>



        <div class="slide" id="slide22">
            <h1>The bad way to store data (text formats)</h1>

            <pre class="examplecode xml">My note:
BEGIN
    FROM: Alice Smith (alice@example.com)
    TO: Robert Jones (roberto@example.com)
    SUBJECT: Tomorrow's "Birthday Bash" event!
    MESSAGE (english):
        Hey Bob,
        Don't forget to call me this weekend!
    PRIVATE: true
END
</pre>

            <ul>
                <li>Many apps make up their own custom text format for storing data.</li>
                <li>We could also send a file like this from the server to browser with Ajax.</li>
                <li>What's wrong with this approach?</li>
            </ul>
        </div>



        <div class="slide" id="slide23">
            <h1>XML: A better way of storing data</h1>

            <pre class="examplecode xml"><em>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</em>
<em>&lt;note private="true"&gt;</em>
    <em>&lt;from&gt;</em>Alice Smith (alice@example.com)<em>&lt;/from&gt;</em>
    <em>&lt;to&gt;</em>Robert Jones (roberto@example.com)<em>&lt;/to&gt;</em>
    <em>&lt;subject&gt;</em>Tomorrow's "Birthday Bash" event!<em>&lt;/subject&gt;</em>
    <em>&lt;message language="english"&gt;</em>
        Hey Bob, Don't forget to call me this weekend!
    <em>&lt;/message&gt;</em>
<em>&lt;/note&gt;</em>
</pre>

            <ul>
                <li><strong>eXtensible Markup Language (XML)</strong> is a format for storing nested data with tags and
                    attributes</li>
                <li>essentially, it's HTML, but you can make up any tags and attributes you want</li>
                <li><a href="http://www.usgovxml.com/">lots of existing data</a> on the web is stored in XML format</li>
            </ul>
        </div>



        <div class="slide" id="slide24">
            <h1>What is XML?</h1>

            <ul>
                <li>XML is a "skeleton" for creating markup languages
                    <ul>
                        <li>you decide on an XML "language" of tags and attributes that you want to allow in your app
                        </li>
                        <li>XML syntax is mostly identical to HTML's:
                            <code
                                class="examplecode">&lt;<var>element</var> <var>attribute</var>="<var>value</var>"&gt;<var>content</var>&lt;/<var>element</var>&gt;</code>
                        </li>
                        <li>the HTML/XML tag syntax is a nice general syntax for describing hierarchical (nested) data
                        </li>
                    </ul>
                </li>

                <li>when you choose to store data in XML format (or access external XML data), you must decide:
                    <ul>
                        <li>names of tags <span class="aside">in HTML: <code>h1</code>, <code>div</code>,
                                <code>img</code>, etc.</span></li>
                        <li>names of attributes <span class="aside">in HTML: <code>id</code>/<code>class</code>,
                                <code>src</code>, <code>href</code>, etc.</span></li>
                        <li>rules about how they go together <span class="aside">in HTML: inline vs. block-level
                                elements</span></li>
                    </ul>
                </li>

                <li>XML presents complex data in a human-readable, "self-describing" form</li>
            </ul>
        </div>



        <div class="slide" id="slide25">
            <h1>Anatomy of an XML file</h1>

            <pre class="examplecode xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;      <span class="comment">&lt;!-- XML prolog --&gt;</span>
&lt;note private="true"&gt;                       <span class="comment">&lt;!-- root element --&gt;</span>
    &lt;from&gt;Alice Smith (alice@example.com)&lt;/from&gt;
    &lt;to&gt;Robert Jones (roberto@example.com)&lt;/to&gt;
    &lt;subject&gt;Tomorrow's "Birthday Bash" event!&lt;/subject&gt;
    &lt;message language="english"&gt;
        Hey Bob, Don't forget to call me this weekend!
    &lt;/message&gt;
&lt;/note&gt;
</pre>

            <ul>
                <li>begins with an <code>&lt;?xml ... ?&gt;</code> header tag (<strong>prolog</strong>)</li>
                <li>has a single <strong>root element</strong> (in this case, <code>note</code>)</li>
                <li>tag, attribute, and comment syntax is just like HTML</li>
            </ul>
        </div>



        <div class="slide" id="slide26">
            <h1>Uses of XML</h1>

            <ul>
                <li>XML data comes from many sources on the web:
                    <ul>
                        <li><span class="term">web servers</span> store data as XML files</li>
                        <li><span class="term">databases</span> sometimes return query results as XML</li>
                        <li><span class="term">web services</span> use XML to communicate</li>
                    </ul>
                </li>

                <li>XML is the <em>de facto</em> universal format for exchange of data</li>

                <li>XML languages are used for <a href="http://en.wikipedia.org/wiki/MusicXML">music</a>, <a
                        href="http://en.wikipedia.org/wiki/MathML">math</a>, <a
                        href="http://en.wikipedia.org/wiki/SVG">vector graphics</a></li>

                <li>popular use: <a href="http://en.wikipedia.org/wiki/RSS">RSS</a> for news feeds &amp; podcasts</li>
            </ul>
        </div>



        <div class="slide" id="slide27">
            <h1>What tags are legal in XML?</h1>

            <pre class="examplecode xml compressed" style="float: right; margin-left: 1em">&lt;measure number="1"&gt;
    &lt;attributes&gt;
        &lt;divisions&gt;1&lt;/divisions&gt;
        &lt;key&gt;&lt;fifths&gt;0&lt;/fifths&gt;&lt;/key&gt;
        &lt;time&gt;&lt;beats&gt;4&lt;/beats&gt;&lt;/time&gt;
        &lt;clef&gt;
            &lt;sign&gt;G&lt;/sign&gt;&lt;line&gt;2&lt;/line&gt;
        &lt;/clef&gt;
    &lt;/attributes&gt;
    &lt;note&gt;
        &lt;pitch&gt;
            &lt;step&gt;C&lt;/step&gt;
            &lt;octave&gt;4&lt;/octave&gt;
        &lt;/pitch&gt;
        &lt;duration&gt;4&lt;/duration&gt;
        &lt;type&gt;whole&lt;/type&gt;
    &lt;/note&gt;
&lt;/measure&gt;
</pre>

            <ul>
                <li><em>any tags you want!</em> examples:
                    <ul>
                        <li>a library might use tags <code>book</code>, <code>title</code>, <code>author</code></li>
                        <li>a song might use tags <code>key</code>, <code>pitch</code>, <code>note</code></li>
                    </ul>
                </li>
                <li>when designing XML data, <em>you</em> choose how to best represent the data
                    <ul>
                        <li>large or complex pieces of data become tags</li>
                        <li>smaller details and metadata with simple types (integer, string, boolean) become attributes
                        </li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide28">
            <h1>Schemas and Doctypes</h1>

            <ul>
                <li>"rule books" describing which tags/attributes you want to allow in your data</li>

                <li>used to <em>validate</em> XML files to make sure they follow the rules of that "flavor"
                    <ul>
                        <li>the W3C HTML validator uses an HTML schema to validate your HTML (related to
                            <code>&lt;!DOCTYPE html&gt;</code> tag)</li>
                    </ul>
                </li>

                <li>these are optional; if you don't have one, there are no rules beyond having well-formed XML syntax
                </li>
                <li>for more info:
                    <ul>
                        <li><a href="http://en.wikipedia.org/wiki/XML_Schema_%28W3C%29">W3C XML Schema</a></li>
                        <li><a href="http://en.wikipedia.org/wiki/Document_Type_Definition">Document Type Definition
                                (DTD)</a> ("doctype")</li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide29">
            <h1>XML and Ajax</h1>

            <div class="rightfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/ajax_bleach.gif" alt="Ajax bleach">
            </div>

            <ul>
                <li>
                    web browsers can display XML files, but often you instead want to fetch one and analyze its data
                </li>

                <li>
                    the XML data is fetched, processed, and displayed using Ajax
                    <ul>
                        <li>
                            (XML is the "X" in "Ajax")
                        </li>
                    </ul>
                </li>

                <li>
                    It would be very clunky to examine a complex XML structure as just a giant string!
                </li>

                <li>luckily, the browser can break apart (<strong>parse</strong>) XML data into a set of objects
                    <ul>
                        <li>there is an XML DOM, similar to the HTML DOM</li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide30">
            <h1>Fetching XML using Ajax (template)</h1>

            <div class="rightfigure">
                <img class="" src="./CSE3026 - 12. Ajax, XML, and JSON_files/figure_6_textbook_cat.gif" alt="node tree"
                    style="max-width: 400px;">
            </div>

            <pre class="syntaxtemplate js">    new Ajax.Request("<var>url</var>", {
        method: "get",
        onSuccess: <var>functionName</var>
    });
    ...

function <var>functionName</var>(ajax) {
    <var>do something with ajax.response<em>XML</em></var>;
}
</pre>

            <ul>
                <li><code>ajax.response<em>Text</em></code> contains the data in plain text</li>
                <li><code>ajax.<a href="http://www.w3schools.com/ajax/ajax_xmlhttprequest_response.asp">response<em>XML</em></a></code>
                    is a parsed XML DOM tree object</li>
            </ul>
        </div>



        <!--
<div class="slide">
	<h1>Structure of an XML document</h1>

	<p>
		XML's syntax looks much like HTML's:
	</p>

	<ul>
		<li>a header, then a single document tag that can contain other tags
<pre class="example xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
<var>document tag</var>
</pre>
		</li>

		<li>tag syntax:
			<pre class="example xml">
&lt;<var>element</var> <var>attribute(s)</var>&gt;
	<var>text or tags</var>
&lt;/<var>element</var>&gt;
</pre>

			<ul>
				<li>or a tag with no inner content can end with /&gt;</li>
			</ul>
		</li>

		<li>attribute syntax:
			<pre class="example xml">
<var>name</var>=&quot;<var>value</var>&quot;
</pre>
		</li>

		<li>comments: <code>&lt;!- <var>comment</var> -&gt;</code></li>
		<li>entities: <code>&amp;lt;</code></li>
	</ul>
</div>
-->



        <div class="slide" id="slide31">
            <h1>XML DOM tree structure</h1>

            <div class="rightfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/figure_6_textbook_cat.gif" alt="node tree"
                    style="max-width: 400px;">
            </div>

            <pre class="examplecode xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;categories&gt; 
  &lt;category&gt;children&lt;/category&gt; 
  &lt;category&gt;computers&lt;/category&gt; 
  ... 
&lt;/categories&gt;
</pre>

            <ul>
                <li>the XML tags have a tree structure</li>
                <li>DOM nodes have parents, children, and siblings</li>
                <li>each DOM node object has properties/methods for accessing nearby nodes</li>
            </ul>
        </div>



        <div class="slide" id="slide32">
            <h1>Interacting with XML DOM nodes</h1>

            <div class="rightfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/figure_6_textbook_cat.gif" alt="node tree"
                    style="max-width: 400px;">
            </div>

            <p>
                To get a list of all nodes that use a given element:
            </p>

            <pre class="syntaxtemplate js">var elms = <var>node</var>.getElementsByTagName("<var>tag</var>");
</pre>

            <p>
                To get the text inside of a node:
            </p>

            <pre class="syntaxtemplate js">var text = <var>node</var>.firstChild.nodeValue;
</pre>

            <p>
                To get an attribute's value from a node:
            </p>

            <pre class="syntaxtemplate js">var attrValue = <var>node</var>.getAttribute("<var>name</var>");
</pre>
        </div>



        <div class="slide" id="slide33">
            <h1>Differences from HTML DOM</h1>

            <p>
                Can't get a list of nodes by id or class using <code>$</code> or <code>$$</code>:
            </p>

            <pre class="syntaxtemplate js">var elms = <del>$$("#main li");</del>   <del>$("id");</del>
</pre>

            <p>
                Can't get/set the text inside of a node using <code>innerHTML</code>:
            </p>

            <pre class="syntaxtemplate js">var text = <del>$("foo").innerHTML</del>;
</pre>

            <p>
                Can't get an attribute's value using <code>.<var>attributeName</var></code>:
            </p>

            <pre class="syntaxtemplate js">var imageUrl = <del>$("myimage").src</del>;
</pre>
        </div>



        <div class="slide" id="slide34">
            <h1>Full list of XML DOM properties</h1>

            <ul>
                <li>properties:
                    <ul>
                        <li><code><strong>nodeName</strong></code>, <code><strong>nodeType</strong></code>,
                            <code><strong>nodeValue</strong></code>, <code><strong>attributes</strong></code></li>
                        <li><code>firstChild</code>, <code>lastChild</code>, <code>childNodes</code>,
                            <code>nextSibling</code>, <code>previousSibling</code>, <code>parentNode</code></li>
                    </ul>
                </li>

                <li>methods:
                    <ul>
                        <li><code><strong>getElementsByTagName</strong></code>,
                            <strong><code>getAttribute</code></strong>, <code><strong>hasAttribute[s]</strong></code>,
                            <code><strong>hasChildNodes</strong></code></li>
                        <li><code>appendChild</code>, <code>insertBefore</code>, <code>removeChild</code>,
                            <code>replaceChild</code></li>
                    </ul>
                </li>
                <li>Caution:
                    <ul>
                        <li>can't use Prototype methods such as <code>up</code>, <code>down</code>,
                            <code>ancestors</code>, <code>childElements</code>, or <code>siblings</code></li>
                        <li>can't use HTML-specific properties like innerHTML in the XML DOM</li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide35">
            <h1>Ajax XML DOM example</h1>

            <pre class="examplecode xml compressed">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;employees&gt;
    &lt;lawyer money="99999.00" /&gt;
    &lt;janitor name="Ed"&gt; &lt;vacuum model="Hoover" /&gt; &lt;/janitor&gt;
    &lt;janitor name="Bill"&gt;no vacuum, too poor&lt;/janitor&gt;
&lt;/employees&gt;
</pre>

            <pre class="examplecode js compressed"><span class="comment">// how much money does the lawyer make?</span>
var lawyer = <em>ajax.responseXML</em>.getElementsByTagName("lawyer")<em>[0]</em>;
var salary = lawyer.<em>getAttribute("money")</em>;      <span class="comment">// "99999.00"</span>

<span class="comment">// array of 2 janitors</span>
var janitors = ajax.responseXML.getElementsByTagName("janitor");
var vacModel = janitors[0].getElementsByTagName("vacuum")[0].getAttribute("model");  <span class="comment">// "Hoover"</span>
var excuse = janitors[1].<em>firstChild.nodeValue</em>;  <span class="comment">// "no vacuum, too poor"</span>
</pre>

            <ul>
                <li>How would we find out the first janitor's name?</li>
                <li>How would we find out how many janitors there are?</li>
                <li>How would we find out how many janitors have vs. don't have vacuums?</li>
            </ul>
        </div>



        <div class="slide" id="slide36">
            <h1>Larger XML file example</h1>

            <pre class="examplecode xml compressed">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;bookstore&gt;
    &lt;book category="cooking"&gt;
        &lt;title lang="en"&gt;Everyday Italian&lt;/title&gt;
        &lt;author&gt;Giada De Laurentiis&lt;/author&gt;
        &lt;year&gt;2005&lt;/year&gt;&lt;price&gt;30.00&lt;/price&gt;
    &lt;/book&gt;
    &lt;book category="computers"&gt;
        &lt;title lang="en"&gt;XQuery Kick Start&lt;/title&gt;
        &lt;author&gt;James McGovern&lt;/author&gt;
        &lt;year&gt;2003&lt;/year&gt;&lt;price&gt;49.99&lt;/price&gt;
    &lt;/book&gt;
    &lt;book category="children"&gt;
        &lt;title lang="en"&gt;Harry Potter&lt;/title&gt;
        &lt;author&gt;J K. Rowling&lt;/author&gt;
        &lt;year&gt;2005&lt;/year&gt;&lt;price&gt;29.99&lt;/price&gt;
    &lt;/book&gt;
    &lt;book category="computers"&gt;
        &lt;title lang="en"&gt;Learning XML&lt;/title&gt;
        &lt;author&gt;Erik T. Ray&lt;/author&gt;
        &lt;year&gt;2003&lt;/year&gt;&lt;price&gt;39.95&lt;/price&gt;
    &lt;/book&gt;
&lt;/bookstore&gt;
</pre>
        </div>


        <!--
<div class="slide">
	<h1>Details about XML node <a href="http://www.w3schools.com/dom/dom_nodes_info.asp">properties</a></h1>

	<ul>
		<li><code>nodeType</code> : what kind of node it is
			<table>
				<tr><th class="spaced">Kind of node</th><th><code>nodeType</code> value</th></tr>
				<tr><td>element</td><td>1</td></tr>
				<tr><td>attribute</td><td>2</td></tr>
				<tr><td>text</td><td>3</td></tr>
				<tr><td>comment</td><td>8</td></tr>
				<tr><td>document</td><td>9</td></tr>
			</table>
		</li>

		<li><code>nodeName</code> : uppercase version of tag such as <code>&quot;DIV&quot;</code> or <code>&quot;ARTICLE&quot;</code>
			<ul>
				<li>an attribute node's name is the attribute's name</li>
				<li>all text nodes have name <code>&quot;#text&quot;</code></li>
				<li>document node has name <code>&quot;#document&quot;</code></li>
			</ul>
		</li>

		<li><code>nodeValue</code> : text inside a text node, or value of an attribute node</li>
	</ul>
</div>
-->



        <div class="slide" id="slide37">
            <h1>Navigating node tree example</h1>

            <pre class="examplecode js narrow"><span class="comment">// make a paragraph for each book about computers</span>
var books = ajax.responseXML.getElementsByTagName("book");
for (var i = 0; i &lt; books.length; i++) {
    var category = books[i].getAttribute("category");
    if (category == "computers") {
        <span class="comment">// extract data from XML</span>
        var title = books[i].getElementsByTagName("title")[0].firstChild.nodeValue;
        var author = books[i].getElementsByTagName("author")[0].firstChild.nodeValue;
        
        <span class="comment">// make an HTML &lt;p&gt; tag containing data from XML</span>
        var p = document.createElement("p");
        p.innerHTML = title + ", by " + author;
        document.body.appendChild(p);
    }
}
</pre>

        </div>



        <!--
<div class="slide">
	<h1>A historical interlude: why HTML?</h1>

	<ul>
		<li>in XML, different "flavors" can be combined in single document</li>
		<li>theoretical benefit of including other XML data in HTML
			<ul>
				<li>nobody does this</li>
			</ul>
		</li>

		<li>most embedded data are in non-XML formats (e.g., Flash)
			<ul>
				<li>non-XML data must be embedded another way (we'll talk about this later on)</li>
			</ul>
		</li>

		<li>requires browser/plugin support for other "flavor" of XML
			<ul>
				<li>development slow to nonexistent</li>
				<li>most XML flavors are specialized uses</li>
			</ul>
		</li>
	</ul>
</div>




<div class="slide">
	<h1>Exercise: Animal game</h1>

	<ul>
		<li>Write a program that guesses which animal the user is thinking of. The program will arrive at a guess based on the user's responses to yes or no questions. The questions come from a web app named <code>animalgame.php</code>.</li>
	</ul>

	<div class="centerfigure">
		<img src="images/animalgame.png" alt="The Animal Game" />
	</div>
</div>



<div class="slide">
	<h1>Practice problem: Animal game (cont'd)</h1>

	<ul>
		<li>The data comes in the following format:

		<pre class="syntaxtemplate xml">
&lt;node nodeid=&quot;<var>id</var>&quot;&gt;
	&lt;question&gt;<var>question text</var>&lt;/question&gt;
	&lt;yes nodeid=&quot;<var>id</var>&quot; /&gt;
	&lt;no nodeid=&quot;<var>id</var>&quot; /&gt;
&lt;/node&gt;
</pre>

		<pre class="syntaxtemplate xml">
&lt;node nodeid=&quot;<var>id</var>&quot;&gt;
	&lt;answer&gt;<var>answer text</var>&lt;/answer&gt;
&lt;/node&gt;
</pre>
		</li>

		<li>to get a node with a given id:  <code>animalgame.php?nodeid=<var>id</var></code>
		</li>

		<li>start by requesting the node with <code>nodeid</code> of <code>1</code> to get the first question</li>
	</ul>
</div>



<div class="slide">
	<h1>Attacking the problem</h1>

	<p>Questions we should ask ourselves:</p>

	<ul>
		<li>How do I retrieve data from the web app? (what URL, etc.)</li>
		<li>Once I retrieve a piece of data, what should I do with it?</li>
		<li>When the user clicks &quot;Yes&quot;, what should I do?</li>
		<li>When the user clicks &quot;No&quot;, what should I do?</li>
		<li>How do I know when the game is over?  What should I do in this case?</li>
	</ul>
</div>
-->

        <!-- ***********************************************************************************************
<div class="slide">
	<h1>Debugging <code>responseXML</code> in Firebug</h1>

	<div class="centerfigure">
		<img src="images/firebug_debug_ajax.png" alt="Firebug Debug Ajax" style="max-width: 70%;" />
	</div>

	<ul>
		<li>can examine the entire XML document, its node/tree structure</li>
	</ul>
</div>
-->


        <div class="slide" id="slide38">
            <h1>Pros and cons of XML</h1>

            <ul>
                <li>pro:
                    <ul>
                        <li>standard open format; don't have to "reinvent the wheel" for storing new types of data</li>
                        <li>can represent almost any general kind of data (record, list, tree)</li>
                        <li>easy to read (for humans and computers)</li>
                        <li>lots of tools exist for working with XML in many languages</li>
                    </ul>
                </li>

                <li>
                    con:
                    <ul>
                        <li>
                            bulky syntax/structure makes files large; can decrease performance
                            (<a
                                href="http://en.wikipedia.org/wiki/MathML#Example_and_comparison_to_other_formats">example</a>)
                        </li>
                        <li>can be hard to "shoehorn" data into a good XML format</li>
                        <li>JavaScript code to navigate the XML DOM is bulky and generally not fun</li>
                    </ul>
                </li>
            </ul>
        </div>



        <div class="slide titleslide" id="slide39">
            <h1>12.4: JSON</h1>

            <ul>
                <li>
                    12.1: Ajax Concepts
                </li>
                <li>
                    12.2: Using XMLHttpRequest
                </li>
                <li>
                    12.3: XML
                </li>
                <li>
                    <strong>12.4: JSON</strong>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide40">
            <h1>JavaScript Object Notation (JSON)</h1>

            <div class="rightfigure">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/json-business-card.jpg" alt="json">
            </div>

            <div class="rightfigure" style="clear: right;">
                <img src="./CSE3026 - 12. Ajax, XML, and JSON_files/douglas-crockford-chuck-norris.jpg" alt="json">
            </div>

            <p>
                <strong>JavaScript Object Notation (JSON):</strong> Data format that represents data as a set of
                JavaScript objects
            </p>

            <ul>
                <li>invented by JS guru <a href="http://www.crockford.com/">Douglas Crockford</a> of Yahoo!</li>
                <li>natively supported by all modern browsers (and libraries to support it in old ones)</li>
                <li>not yet as popular as XML, but steadily rising due to its simplicity and ease of use</li>
            </ul>
        </div>



        <div class="slide" id="slide41">
            <h1>Recall: JavaScript object syntax</h1>

            <pre class="examplecode js">var person = {
    name: "Philip J. Fry",                           <span class="comment">// string</span>
    age: 23,                                         <span class="comment">// number</span>
    "weight": 172.5,                                 <span class="comment">// number</span>
    friends: ["Farnsworth", "Hermes", "Zoidberg"],   <span class="comment">// array</span>
    getBeloved: function() { return this.name + " loves Leela"; }
};
alert(person.age);                                 <span class="comment">// 23</span>
alert(person["weight"]);                           <span class="comment">// 172.5</span>
alert(person.friends[2]));                         <span class="comment">// Zoidberg</span>
alert(person.getBeloved());                        <span class="comment">// Philip J. Fry loves Leela</span>
</pre>

            <ul>
                <li>in JavaScript, you can create a new object without creating a class</li>
                <li>the object can have methods (function properties) that refer to itself as <code>this</code></li>
                <li>can refer to the fields with <code>.<var>fieldName</var></code> or
                    <code>["<var>fieldName</var>"]</code> syntax</li>
                <li>field names can optionally be put in quotes (e.g. <code>weight</code> above)</li>
            </ul>
        </div>



        <div class="slide" id="slide42">
            <h1>An example of XML data</h1>

            <pre class="examplecode xml"><em>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</em>
<em>&lt;note private="true"&gt;</em>
    <em>&lt;from&gt;</em>Alice Smith (alice@example.com)<em>&lt;/from&gt;</em>
    <em>&lt;to&gt;</em>Robert Jones (roberto@example.com)<em>&lt;/to&gt;</em>
    <em>&lt;to&gt;</em>Charles Dodd (cdodd@example.com)<em>&lt;/to&gt;</em>
    <em>&lt;subject&gt;</em>Tomorrow's "Birthday Bash" event!<em>&lt;/subject&gt;</em>
    <em>&lt;message language="english"&gt;</em>
        Hey guys, don't forget to call me this weekend!
    <em>&lt;/message&gt;</em>
<em>&lt;/note&gt;</em>
</pre>
        </div>



        <div class="slide" id="slide43">
            <h1>The equivalant JSON data</h1>

            <pre class="examplecode json">{
    "private": "true",
    "from": "Alice Smith (alice@example.com)",
    "to": [
        "Robert Jones (roberto@example.com)",
        "Charles Dodd (cdodd@example.com)"
    ],
    "subject": "Tomorrow's \"Birthday Bash\" event!",
    "message": {
        "language": "english",
        "text": "Hey guys, don't forget to call me this weekend!"
    }
}
</pre>
        </div>



        <div class="slide" id="slide44">
            <h1>Browser <a class="popup"
                    href="https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/JSON#Methods"
                    target="_blank">JSON methods</a></h1>

            <table class="standard">
                <tbody>
                    <tr class=" evenrow">
                        <th>method</th>
                        <th>description</th>
                    </tr>

                    <tr>
                        <td>
                            <code>JSON.parse(<var>string</var>)</code>
                        </td>
                        <td>
                            converts the given string of JSON data into an equivalent JavaScript object and returns it
                        </td>
                    </tr>

                    <tr class=" evenrow">
                        <td>
                            <code>JSON.stringify(<var>object</var>)</code>
                        </td>
                        <td>
                            converts the given object into a string of JSON data (the opposite of
                            <code>JSON.parse</code>)
                        </td>
                    </tr>
                </tbody>
            </table>

            <ul>
                <li>you can use Ajax to fetch data that is in JSON format</li>
                <li>then call <code>JSON.parse</code> on it to convert it into an object</li>
                <li>then interact with that object as you would with any other JavaScript object</li>
            </ul>
        </div>



        <div class="slide" id="slide45">
            <h1>JSON expressions exercise</h1>

            <div class="rightfigure" style="text-align: left;">
                <pre class="examplecode js compressed">var <em>data</em> = JSON.parse(ajax.responseText);
</pre>

                <pre class="examplecode json compressed">{
    "window": {
        "title": "Sample Widget",
        "width": 500,
        "height": 500
    },
    "image": { 
        "src": "images/logo.png",
        "coords": [250, 150, 350, 400],
        "alignment": "center"
    },
    "messages": [
        {"text": "Save", "offset": [10, 30]}
        {"text": "Help", "offset": [ 0, 50]},
        {"text": "Quit", "offset": [30, 10]},
    ],
    "debug": "true"
}
</pre>
            </div>

            <p>
                Given the JSON data at right, what expressions would produce:
            </p>

            <ul>
                <li>The window's title?</li>
                <li>The image's third coordinate?</li>
                <li>The number of messages?</li>
                <li>The y-offset of the last message?</li>
            </ul>

            <pre class=" compressed">var title = data.window.title;
var coord = data.image.coords[2];
var len = data.messages.length;
var y = data.messages[len - 1].offset[1];
</pre>
        </div>



        <div class="slide" id="slide46">
            <h1>JSON example: Books</h1>

            <p>
                Suppose we have a service <a
                    href="http://selab.hanyang.ac.kr/courses/cse326/2017/lecture/examples/12JSON/books_json.php"><code>books_json.php</code></a>
                about library books.
            </p>

            <ul>
                <li>
                    If no query parameters are passed, it outputs a list of book categories:

                    <pre class="examplecode json">{ "categories": ["computers", "cooking", "finance", ...] }
</pre>
                </li>

                <li>
                    Supply a <code>category</code> query parameter to see all books in one category: <br>
                    <a
                        href="http://selab.hanyang.ac.kr/courses/cse326/2017/lecture/examples/12JSON/books_json.php?category=cooking">http://selab.hanyang.ac.kr/.../books_json.php?category=cooking</a>

                    <pre class="examplecode json">{
    "books": [
        {"category": "cooking", "year": 2009, "price": 22.00, 
         "title": "Breakfast for Dinner", "author": "Amanda Camp"},
        {"category": "cooking", "year": 2010, "price": 75.00, 
         "title": "21 Burgers for the 21st Century", "author": "Stuart Reges"},
        ...
    ]
}
</pre>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide47">
            <h1>JSON exercise</h1>

            <p>
                Write a page that processes this JSON book data.
            </p>

            <ul>
                <li>Initially the page lets the user choose a category, created from the JSON data.
                    <ul>
                        <li>
                            <label><input type="radio" name="category" value="children"> Children</label>
                            <label><input type="radio" name="category" value="computers"> Computers</label>
                            <label><input type="radio" name="category" value="finance"> Finance</label>
                            <button>List Books</button>
                        </li>
                    </ul>
                </li>

                <li>
                    After choosing a category, the list of books in it appears:

                    <div style="border: 1px solid gray;">
                        Books in category "Cooking":
                        <ul>
                            <li>Breakfast for Dinner, by Amanda Camp (2009)</li>
                            <li>21 Burgers for the 21st Century, by Stuart Reges (2010)</li>
                            <li>The Four Food Groups of Chocolate, by Victoria Kirst (2005)</li>
                        </ul>
                    </div>
                </li>
            </ul>
        </div>



        <div class="slide" id="slide48">
            <h1>Working with JSON book data</h1>

            <div class="example">
                <pre class="examplecode js">function showBooks(ajax) {
    // add all books from the JSON data to the page's bulleted list
    var data = <em>JSON.parse(ajax.responseText)</em>;
    for (var i = 0; i &lt; data.books.length; i++) {
        var li = document.createElement("li");
        li.innerHTML = data.books[i].title + ", by " +
                data.books[i].author + " (" + data.books[i].year + ")";
        $("books").appendChild(li);
    }
}
</pre>
            </div>
        </div>



        <div class="slide" id="slide49">
            <h1>Bad style: the <code>eval</code> function</h1>

            <pre class="examplecode js"><span class="comment">// var data = JSON.parse(ajax.responseText);</span>
var data = <em>eval</em>(ajax.responseText);   <span class="comment">// don't do this!</span>
...
</pre>

            <ul>
                <li>JavaScript includes an <code>eval</code> keyword that takes a string and runs it as code</li>
                <li>this is essentially the same as what <code>JSON.parse</code> does,</li>
                <li>but <code>JSON.parse</code> filters out potentially dangerous code; <code>eval</code> doesn't</li>
                <li><code>eval</code> is evil and should not be used!</li>
            </ul>
        </div>


    </div><!-- end div class="presentation" -->

</body>

</html>